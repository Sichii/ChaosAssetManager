<UserControl x:Class="ChaosAssetManager.Controls.NPCContentEditorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:previewControls="clr-namespace:ChaosAssetManager.Controls.PreviewControls"
             mc:Ignorable="d"
             d:DesignHeight="625"
             d:DesignWidth="700"
             Background="{DynamicResource MaterialDesignPaper}"
             TextElement.FontWeight="Medium"
             TextElement.FontSize="14"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}"
             FontFamily="{materialDesign:MaterialDesignFont}"
             DataContext="{Binding RelativeSource={RelativeSource Self}}">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"
                              MinWidth="300" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Controls -->
        <Grid Grid.Column="0"
              Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Direction Selector -->
            <GroupBox Grid.Row="0"
                      Header="Direction"
                      Margin="0,0,0,10"
                      Padding="5"
                      HorizontalAlignment="Center">
                <Grid HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Button x:Name="DirLeftBtn"
                            Grid.Row="0"
                            Grid.Column="0"
                            Content="{materialDesign:PackIcon Kind=ArrowTopLeft}"
                            Tag="Left"
                            Click="Direction_OnClick"
                            Background="White"
                            Foreground="Black"
                            Padding="7"
                            Margin="2" />
                    <Button x:Name="DirUpBtn"
                            Grid.Row="0"
                            Grid.Column="1"
                            Content="{materialDesign:PackIcon Kind=ArrowTopRight}"
                            Tag="Up"
                            Click="Direction_OnClick"
                            Background="White"
                            Foreground="Black"
                            Padding="7"
                            Margin="2" />
                    <Button x:Name="DirDownBtn"
                            Grid.Row="1"
                            Grid.Column="0"
                            Content="{materialDesign:PackIcon Kind=ArrowBottomLeft}"
                            Tag="Down"
                            Click="Direction_OnClick"
                            Background="White"
                            Foreground="Black"
                            Padding="7"
                            Margin="2" />
                    <Button x:Name="DirRightBtn"
                            Grid.Row="1"
                            Grid.Column="1"
                            Content="{materialDesign:PackIcon Kind=ArrowBottomRight}"
                            Tag="Right"
                            Click="Direction_OnClick"
                            Background="White"
                            Foreground="Black"
                            Padding="7"
                            Margin="2" />
                </Grid>
            </GroupBox>

            <!-- Movement Buttons -->
            <Grid Grid.Row="1"
                  Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Frame Position -->
                <GroupBox Grid.Column="0"
                          Header="Frame Position"
                          Padding="5"
                          Margin="0,0,5,0">
                    <Grid HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Button Grid.Row="0"
                                Grid.Column="1"
                                Content="{materialDesign:PackIcon Kind=ArrowUp}"
                                Click="MoveFrameUp_OnClick"
                                Background="#FFFFCC00"
                                Foreground="Black"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                        <Button Grid.Row="1"
                                Grid.Column="0"
                                Content="{materialDesign:PackIcon Kind=ArrowLeft}"
                                Click="MoveFrameLeft_OnClick"
                                Background="#FFFFCC00"
                                Foreground="Black"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                        <ToggleButton x:Name="MoveAllFramesChk"
                                      Grid.Row="1"
                                      Grid.Column="1"
                                      ToolTip="Move all frames"
                                      Margin="3"
                                      Padding="0" />
                        <Button Grid.Row="1"
                                Grid.Column="2"
                                Content="{materialDesign:PackIcon Kind=ArrowRight}"
                                Click="MoveFrameRight_OnClick"
                                Background="#FFFFCC00"
                                Foreground="Black"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                        <Button Grid.Row="2"
                                Grid.Column="1"
                                Content="{materialDesign:PackIcon Kind=ArrowDown}"
                                Click="MoveFrameDown_OnClick"
                                Background="#FFFFCC00"
                                Foreground="Black"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                    </Grid>
                </GroupBox>

                <!-- Center Point -->
                <GroupBox Grid.Column="1"
                          Header="Center Point"
                          Padding="5"
                          Margin="5,0,0,0">
                    <Grid HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Button Grid.Row="0"
                                Grid.Column="1"
                                Content="{materialDesign:PackIcon Kind=ArrowUp}"
                                Click="MoveCenterUp_OnClick"
                                Background="#FFFF00FF"
                                Foreground="White"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                        <Button Grid.Row="1"
                                Grid.Column="0"
                                Content="{materialDesign:PackIcon Kind=ArrowLeft}"
                                Click="MoveCenterLeft_OnClick"
                                Background="#FFFF00FF"
                                Foreground="White"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                        <ToggleButton x:Name="MoveAllCentersChk"
                                      Grid.Row="1"
                                      Grid.Column="1"
                                      ToolTip="Move all center points"
                                      Margin="3" />
                        <Button Grid.Row="1"
                                Grid.Column="2"
                                Content="{materialDesign:PackIcon Kind=ArrowRight}"
                                Click="MoveCenterRight_OnClick"
                                Background="#FFFF00FF"
                                Foreground="White"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                        <Button Grid.Row="2"
                                Grid.Column="1"
                                Content="{materialDesign:PackIcon Kind=ArrowDown}"
                                Click="MoveCenterDown_OnClick"
                                Background="#FFFF00FF"
                                Foreground="White"
                                Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}"
                                Padding="10" />
                    </Grid>
                </GroupBox>
            </Grid>

            <!-- File Properties -->
            <Grid Grid.Row="2"
                  Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Walk -->
                <TextBlock Grid.Row="0"
                           Grid.Column="0"
                           Text="Walk Index:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="0"
                         Grid.Column="1"
                         Text="{Binding WalkFrameIndex, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,3" />
                <TextBlock Grid.Row="0"
                           Grid.Column="2"
                           Text="Count:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="0"
                         Grid.Column="3"
                         Text="{Binding WalkFrameCount, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,3" />

                <!-- Attack -->
                <TextBlock Grid.Row="1"
                           Grid.Column="0"
                           Text="Attack Index:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="1"
                         Grid.Column="1"
                         Text="{Binding AttackFrameIndex, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,3" />
                <TextBlock Grid.Row="1"
                           Grid.Column="2"
                           Text="Count:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="1"
                         Grid.Column="3"
                         Text="{Binding AttackFrameCount, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,3" />

                <!-- Attack 2 (MultipleAttacks only) -->
                <TextBlock Grid.Row="2"
                           Grid.Column="0"
                           Text="Attack 2 Index:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3"
                           Visibility="{Binding MultipleAttacksVisibility}" />
                <TextBox Grid.Row="2"
                         Grid.Column="1"
                         Text="{Binding Attack2StartIndex, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,3"
                         Visibility="{Binding MultipleAttacksVisibility}" />
                <TextBlock Grid.Row="2"
                           Grid.Column="2"
                           Text="Count:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3"
                           Visibility="{Binding MultipleAttacksVisibility}" />
                <TextBox Grid.Row="2"
                         Grid.Column="3"
                         Text="{Binding Attack2FrameCount, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,3"
                         Visibility="{Binding MultipleAttacksVisibility}" />

                <!-- Attack 3 (MultipleAttacks only) -->
                <TextBlock Grid.Row="3"
                           Grid.Column="0"
                           Text="Attack 3 Index:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3"
                           Visibility="{Binding MultipleAttacksVisibility}" />
                <TextBox Grid.Row="3"
                         Grid.Column="1"
                         Text="{Binding Attack3StartIndex, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,3"
                         Visibility="{Binding MultipleAttacksVisibility}" />
                <TextBlock Grid.Row="3"
                           Grid.Column="2"
                           Text="Count:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3"
                           Visibility="{Binding MultipleAttacksVisibility}" />
                <TextBox Grid.Row="3"
                         Grid.Column="3"
                         Text="{Binding Attack3FrameCount, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,3"
                         Visibility="{Binding MultipleAttacksVisibility}" />

                <!-- Standing -->
                <TextBlock Grid.Row="4"
                           Grid.Column="0"
                           Text="Standing Index:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="4"
                         Grid.Column="1"
                         Text="{Binding StandingFrameIndex, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,3" />
                <TextBlock Grid.Row="4"
                           Grid.Column="2"
                           Text="Count:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="4"
                         Grid.Column="3"
                         Text="{Binding StandingFrameCount, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,3" />

                <!-- Stop-motion -->
                <TextBlock Grid.Row="5"
                           Grid.Column="0"
                           Text="Stop-motion Count:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="5"
                         Grid.Column="1"
                         Text="{Binding OptionalAnimationFrameCount, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,3" />
                <TextBlock Grid.Row="5"
                           Grid.Column="2"
                           Text="Ratio:"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,5,3" />
                <TextBox Grid.Row="5"
                         Grid.Column="3"
                         Text="{Binding StopMotionRatio, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,3"
                         ToolTip="Percentage chance to play stop-motion frames" />
            </Grid>

            <!-- Stop Motion Ratio (conditional) - now hidden since it's in File Properties -->
            <StackPanel x:Name="StopMotionPanel"
                        Grid.Row="3"
                        Orientation="Horizontal"
                        Margin="0,0,0,10"
                        Visibility="Collapsed">
                <TextBlock Text="Stop Motion Ratio:"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0" />
                <TextBox x:Name="StopMotionRatioTxt"
                         Text="{Binding StopMotionRatio, UpdateSourceTrigger=PropertyChanged}"
                         Width="60"
                         Style="{StaticResource MaterialDesignTextBox}"
                         ToolTip="Percentage chance to play optional frames (e.g. 30 = 30% of the time)" />
            </StackPanel>

            <!-- Frame Selector with Animation and Play/Pause -->
            <StackPanel Grid.Row="4">
                <!-- Animation Selector Row -->
                <Grid Margin="0,0,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="Animation"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0" />

                    <ComboBox x:Name="AnimationTypeCmb"
                              Grid.Column="1"
                              HorizontalAlignment="Stretch"
                              SelectionChanged="AnimationType_OnSelectionChanged"
                              Style="{StaticResource MaterialDesignComboBox}" />

                    <Button x:Name="PlayPauseBtn"
                            Grid.Column="2"
                            Content="{materialDesign:PackIcon Kind=Play}"
                            Click="PlayPause_OnClick"
                            Margin="10,0,0,0"
                            Style="{StaticResource MaterialDesignFlatSecondaryMidBgButton}" />
                </Grid>

                <!-- Frames Header Row -->
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="Frames"
                               VerticalAlignment="Center" />

                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <TextBlock Text="Bounds"
                                   VerticalAlignment="Center"
                                   Margin="0,0,5,0" />
                        <ToggleButton x:Name="ShowBoundsChk"
                                      VerticalAlignment="Center"
                                      Checked="ShowBoundsChk_OnChecked"
                                      Unchecked="ShowBoundsChk_OnChecked" />
                    </StackPanel>
                </Grid>

                <ListView x:Name="FramesListView"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          MaxHeight="300"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          SelectionChanged="Frame_OnSelectionChanged" />
            </StackPanel>
        </Grid>

        <!-- Right Panel: Preview -->
        <previewControls:SKGLElementPlus Grid.Column="1"
                                         x:Name="PreviewElement"
                                         Margin="10"
                                         Paint="PreviewElement_OnPaint"
                                         Loaded="PreviewElement_OnLoaded" />

        <materialDesign:Snackbar x:Name="Snackbar"
                                 Grid.Column="0"
                                 Grid.ColumnSpan="2"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Bottom"
                                 MessageQueue="{materialDesign:MessageQueue}" />
    </Grid>
</UserControl>